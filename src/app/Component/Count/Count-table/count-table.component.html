<!-- Зона загрузки файла -->
<div class="upload-container"
     (dragover)="onDragOver($event)"
     (drop)="onDrop($event)"
     (click)="fileInput.click()">
  <input #fileInput type="file" accept=".zip" (change)="onFileSelected($event)" hidden>
  <p>Перенесите архив или нажмите здесь для выбора файла</p>
</div>

<!-- Кнопка для скачивания модифицированного архива -->
<div *ngIf="originalZip">
  <button (click)="onDownloadArchives()">Скачать новый архив</button>
</div>

<!-- Вывод списка файлов из архива -->
<div *ngIf="files.length">
  <h3>Содержимое архива:</h3>
  <ul>
    <li *ngFor="let file of files">{{ file.name }}</li>
  </ul>
</div>

<!-- Вывод таблиц, сгруппированных по MarketURL -->
<div *ngIf="tableHeaders.length && tableData.length">
  <div *ngFor="let group of groupedTableData | keyvalue">
    <h3>MarketURL: {{ group.key }}</h3>
    <!-- Отображение общей суммы для магазина -->
    <p><strong>Общая сумма Price:</strong> {{ groupTotals[group.key] }}</p>
    <table mat-table [dataSource]="group.value" class="mat-elevation-z8">
      <!-- Динамическое создание колонок по tableHeaders -->
      <ng-container *ngFor="let column of tableHeaders" [matColumnDef]="column">
        <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
        <td mat-cell *matCellDef="let element">{{ element[column] }}</td>
      </ng-container>
      
      <!-- Ряды заголовков и данных -->
      <tr mat-header-row *matHeaderRowDef="tableHeaders"></tr>
      <tr mat-row *matRowDef="let row; columns: tableHeaders;"></tr>
    </table>
    <br>
  </div>

  <!-- Итоговая сводная таблица -->
  <div class="summary">
    <h3>Сводная информация по магазинам</h3>
    <table mat-table [dataSource]="groupedTableData | keyvalue" class="mat-elevation-z8">
      <!-- Колонка для адреса магазина -->
      <ng-container matColumnDef="market">
        <th mat-header-cell *matHeaderCellDef>MarketURL</th>
        <td mat-cell *matCellDef="let item">{{ item.key }}</td>
      </ng-container>
      <!-- Колонка для суммы -->
      <ng-container matColumnDef="total">
        <th mat-header-cell *matHeaderCellDef>Сумма Price</th>
        <td mat-cell *matCellDef="let item">{{ groupTotals[item.key] }}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="['market', 'total']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['market', 'total'];"></tr>
    </table>
    <!-- Общая сумма по всем магазинам -->
    <p><strong>Общая сумма по всем магазинам: </strong>{{ overallTotal }}</p>
  </div>
</div>
